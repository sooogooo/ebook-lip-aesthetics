//绛唇解语花-图表库 document.addEventListener('DOMContentLoaded',()=>{fetch('sample_data.json').then(response=>response.json()).then(data=>{createAgePieChart(data.case_statistics.age_distribution);createTreatmentFrequencyBar(data.case_statistics.treatment_frequency);createMonthlyCasesLine(data.case_statistics.monthly_cases);createSuccessRateStacked(data.case_statistics.success_rate);createMultiDimensionRadar(data.satisfaction_survey.multi_dimension_satisfaction);createDoctorRatingHeatmap(data.satisfaction_survey.doctor_ratings);createFeedbackWordcloud(data.satisfaction_survey.feedback_keywords);createTechParallelCoordinates(data.technology_analysis.tech_comparison);createRiskLevelsPieChart(data.risk_assessment.risk_levels);});});function createAgePieChart(ageData){const ctx=document.getElementById('age-distribution-pie').getContext('2d');new Chart(ctx,{type:'pie',data:{labels:Object.keys(ageData),datasets:[{data:Object.values(ageData),backgroundColor:['#8B0000','#DC143C','#FF4500','#FF6347','#FF7F50']}]},options:{responsive:true,title:{display:true,text:'患者年龄分布'}}});}function createTreatmentFrequencyBar(treatmentData){const ctx=document.getElementById('treatment-frequency-bar').getContext('2d');new Chart(ctx,{type:'bar',data:{labels:Object.keys(treatmentData),datasets:[{label:'使用频率',data:Object.values(treatmentData),backgroundColor:'#8B0000'}]},options:{responsive:true,scales:{y:{beginAtZero:true}}}});}function createMonthlyCasesLine(monthlyData){const ctx=document.getElementById('monthly-cases-line').getContext('2d');new Chart(ctx,{type:'line',data:{labels:monthlyData.map(d=>d.month),datasets:[{label:'月度案例数',data:monthlyData.map(d=>d.cases),borderColor:'#8B0000',fill:false}]},options:{responsive:true}});}function createSuccessRateStacked(successData){const ctx=document.getElementById('success-rate-stacked').getContext('2d');new Chart(ctx,{type:'bar',data:{labels:['治疗效果'],datasets:[{label:'成功率',data:[successData.成功率],backgroundColor:'#32CD32'},{label:'并发症率',data:[successData.并发症率],backgroundColor:'#FF4500'}]},options:{responsive:true,scales:{y:{stacked:true}}}});}function createMultiDimensionRadar(satisfactionData){const ctx=document.getElementById('multi-dimension-radar').getContext('2d');new Chart(ctx,{type:'radar',data:{labels:Object.keys(satisfactionData),datasets:[{label:'满意度评估',data:Object.values(satisfactionData),backgroundColor:'rgba(139,0,0,0.2)',borderColor:'#8B0000'}]},options:{responsive:true}});}function createDoctorRatingHeatmap(ratingData){const ctx=document.getElementById('doctor-rating-heatmap').getContext('2d');new Chart(ctx,{type:'bar',data:{labels:ratingData.map(d=>d.doctor),datasets:[{label:'医生评分',data:ratingData.map(d=>d.rating),backgroundColor:'#8B0000'}]},options:{responsive:true}});}function createFeedbackWordcloud(keywordsData){const wordcloud=document.getElementById('feedback-wordcloud');const words=keywordsData.map(k=>({text:k.text,size:k.weight*2}));const width=400,height=300;const svg=d3.select(wordcloud).append('svg').attr('width',width).attr('height',height);d3.layout.cloud().size([width,height]).words(words).padding(5).rotate(()=>~~(Math.random()*2)*90).fontSize(d=>d.size).on('end',draw).start();function draw(words){svg.append('g').attr('trans for m',`translate(${width/2},${height/2})`).selectAll('text').data(words).enter().append('text').style('font-size',d=>`${d.size}px`).style('fill','#8B0000').attr('text-anchor','middle').attr('trans for m',d=>`translate(${d.x},${d.y})rotate(${d.rotate})`).text(d=>d.text);}}function createTechParallelCoordinates(techData){const margin={top:30,right:10,bottom:10,left:10},width=460-margin.left-margin.right,height=400-margin.top-margin.bottom;const svg=d3.select('#tech-parallel-coordinates').append('svg').attr('width',width+margin.left+margin.right).attr('height',height+margin.top+margin.bottom).append('g').attr('trans for m',`translate(${margin.left},${margin.top})`);const dimensions=['precision','recovery','naturalness'];const y={};dimensions.forEach(dim=>{y[dim]=d3.scaleLinear().domain(d3.extent(techData,d=>d[dim])).range([height,0]);});const x=d3.scalePoint().range([0,width]).padding(1).domain(dimensions);function path(d){return d3.line()(dimensions.map(p=>[x(p),y[p](d[p])]));}svg.add('g').selectAll('path').data(techData).enter().append('path').attr('d',path).style('fill','none').style('stroke','#8B0000').style('opacity',0.5);svg.selectAll('axis').data(dimensions).enter().append('g').attr('trans for m',d=>`translate(${x(d)},0)`).each(function(d){d3.select(this).call(d3.axisLeft(y[d]));}).append('text').attr('text-anchor','middle').attr('y',-9).text(d=>d).style('fill','black');}function createRiskLevelsPieChart(riskData){const ctx=document.getElementById('risk-warning-gauge').getContext('2d');new Chart(ctx,{type:'pie',data:{labels:Object.keys(riskData),datasets:[{data:Object.values(riskData),backgroundColor:['#32CD32','#FFA500','#FF4500']}]},options:{responsive:true,title:{display:true,text:'风险水平分布'}}});}