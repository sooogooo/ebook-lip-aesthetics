<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›†æˆæµ‹è¯•ä¸­å¿ƒ - ç»›å”‡è§£è¯­èŠ±</title>
    <link rel="icon" href="https://docs.bccsw.cn/favicon.png">
    <link rel="apple-touch-icon" href="https://docs.bccsw.cn/logo.png">
    <style>
        :root{--primary:#E91E63;--success:#4CAF50;--warning:#FF9800;--error:#F44336;--bg:#FAFAFA;--card:#FFF;--text:#212121}
        *{margin:0;padding:0;box-sizing:border-box}
        body{font:14px/1.5 system-ui,sans-serif;background:var(--bg);color:var(--text);padding:20px}
        .container{max-width:1200px;margin:0 auto}
        .header{background:var(--card);padding:20px;border-radius:8px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
        .title{color:var(--primary);font-size:24px;font-weight:600;text-align:center;margin-bottom:10px}
        .subtitle{text-align:center;color:#757575}
        .test-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:20px}
        .test-card{background:var(--card);border-radius:8px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
        .test-title{color:var(--primary);font-weight:600;margin-bottom:15px;display:flex;align-items:center;gap:10px}
        .test-status{display:inline-block;width:12px;height:12px;border-radius:50%;margin-right:8px}
        .status-pending{background:#757575}
        .status-running{background:var(--warning);animation:pulse 1s infinite}
        .status-success{background:var(--success)}
        .status-error{background:var(--error)}
        .test-item{display:flex;justify-content:space-between;align-items:center;padding:8px 0;border-bottom:1px solid #eee}
        .test-item:last-child{border-bottom:none}
        .test-name{flex:1}
        .test-result{padding:4px 8px;border-radius:4px;font-size:12px;font-weight:500}
        .result-pass{background:#E8F5E8;color:var(--success)}
        .result-fail{background:#FFEBEE;color:var(--error)}
        .result-pending{background:#F5F5F5;color:#757575}
        .actions{display:flex;gap:10px;margin-top:20px;justify-content:center}
        .btn{padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;transition:all .3s}
        .btn-primary{background:var(--primary);color:white}
        .btn-primary:hover{background:#AD1457}
        .btn-secondary{background:#757575;color:white}
        .btn-secondary:hover{background:#424242}
        .summary{background:var(--card);padding:20px;border-radius:8px;margin-top:20px;box-shadow:0 2px 8px rgba(0,0,0,.1)}
        .summary-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:20px;text-align:center}
        .metric{padding:15px}
        .metric-value{font-size:24px;font-weight:600;color:var(--primary)}
        .metric-label{color:#757575;font-size:12px;margin-top:5px}
        .log{background:#000;color:#00ff00;padding:15px;border-radius:8px;font-family:monospace;font-size:12px;max-height:200px;overflow-y:auto;margin-top:20px}
        @keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
        @media(max-width:768px){.container{padding:10px}.test-grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 class="title">ğŸ§ª é›†æˆæµ‹è¯•ä¸­å¿ƒ</h1>
            <p class="subtitle">å¯è§†åŒ–ç³»ç»Ÿå®Œæ•´æ€§éªŒè¯</p>
        </div>

        <div class="test-grid">
            <!-- åŠŸèƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3 class="test-title">
                    <span class="test-status status-pending" id="functional-status"></span>
                    âš™ï¸ åŠŸèƒ½æµ‹è¯•
                </h3>
                <div id="functional-tests">
                    <div class="test-item">
                        <span class="test-name">å¯è§†åŒ–ä¸­å¿ƒåŠ è½½</span>
                        <span class="test-result result-pending" id="test-hub">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">3Dæ¨¡å‹æ¸²æŸ“</span>
                        <span class="test-result result-pending" id="test-3d">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">æ•°æ®é¢æ¿</span>
                        <span class="test-result result-pending" id="test-dashboard">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">ç§»åŠ¨ç«¯é€‚é…</span>
                        <span class="test-result result-pending" id="test-mobile">å¾…æµ‹è¯•</span>
                    </div>
                </div>
            </div>

            <!-- æ€§èƒ½æµ‹è¯• -->
            <div class="test-card">
                <h3 class="test-title">
                    <span class="test-status status-pending" id="performance-status"></span>
                    ğŸš€ æ€§èƒ½æµ‹è¯•
                </h3>
                <div id="performance-tests">
                    <div class="test-item">
                        <span class="test-name">é¦–å±åŠ è½½æ—¶é—´</span>
                        <span class="test-result result-pending" id="test-fcp">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">JavaScriptæ‰§è¡Œ</span>
                        <span class="test-result result-pending" id="test-js">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">å†…å­˜ä½¿ç”¨</span>
                        <span class="test-result result-pending" id="test-memory">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">æ¸²æŸ“å¸§ç‡</span>
                        <span class="test-result result-pending" id="test-fps">å¾…æµ‹è¯•</span>
                    </div>
                </div>
            </div>

            <!-- å…¼å®¹æ€§æµ‹è¯• -->
            <div class="test-card">
                <h3 class="test-title">
                    <span class="test-status status-pending" id="compatibility-status"></span>
                    ğŸŒ å…¼å®¹æ€§æµ‹è¯•
                </h3>
                <div id="compatibility-tests">
                    <div class="test-item">
                        <span class="test-name">WebGLæ”¯æŒ</span>
                        <span class="test-result result-pending" id="test-webgl">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">Service Worker</span>
                        <span class="test-result result-pending" id="test-sw">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">è§¦æ‘¸æ‰‹åŠ¿</span>
                        <span class="test-result result-pending" id="test-touch">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">PWAåŠŸèƒ½</span>
                        <span class="test-result result-pending" id="test-pwa">å¾…æµ‹è¯•</span>
                    </div>
                </div>
            </div>

            <!-- å®‰å…¨æµ‹è¯• -->
            <div class="test-card">
                <h3 class="test-title">
                    <span class="test-status status-pending" id="security-status"></span>
                    ğŸ”’ å®‰å…¨æµ‹è¯•
                </h3>
                <div id="security-tests">
                    <div class="test-item">
                        <span class="test-name">HTTPSåŠ å¯†</span>
                        <span class="test-result result-pending" id="test-https">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">XSSé˜²æŠ¤</span>
                        <span class="test-result result-pending" id="test-xss">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">å†…å®¹å®‰å…¨ç­–ç•¥</span>
                        <span class="test-result result-pending" id="test-csp">å¾…æµ‹è¯•</span>
                    </div>
                    <div class="test-item">
                        <span class="test-name">æ•°æ®éšç§</span>
                        <span class="test-result result-pending" id="test-privacy">å¾…æµ‹è¯•</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="actions">
            <button class="btn btn-primary" onclick="runAllTests()">ğŸš€ è¿è¡Œå…¨éƒ¨æµ‹è¯•</button>
            <button class="btn btn-secondary" onclick="runSingleTest()">ğŸ¯ å•é¡¹æµ‹è¯•</button>
            <button class="btn btn-secondary" onclick="generateReport()">ğŸ“Š ç”ŸæˆæŠ¥å‘Š</button>
        </div>

        <div class="summary">
            <div class="summary-grid">
                <div class="metric">
                    <div class="metric-value" id="total-tests">16</div>
                    <div class="metric-label">æ€»æµ‹è¯•æ•°</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="passed-tests">0</div>
                    <div class="metric-label">é€šè¿‡</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="failed-tests">0</div>
                    <div class="metric-label">å¤±è´¥</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="test-time">0s</div>
                    <div class="metric-label">æµ‹è¯•æ—¶é—´</div>
                </div>
                <div class="metric">
                    <div class="metric-value" id="success-rate">0%</div>
                    <div class="metric-label">æˆåŠŸç‡</div>
                </div>
            </div>
        </div>

        <div class="log" id="test-log">
            > é›†æˆæµ‹è¯•ç³»ç»Ÿå°±ç»ªï¼Œç‚¹å‡»"è¿è¡Œå…¨éƒ¨æµ‹è¯•"å¼€å§‹éªŒè¯...<br>
        </div>
    </div>

    <script>
        class IntegrationTester {
            constructor() {
                this.tests = {
                    functional: [
                        { id: 'test-hub', name: 'å¯è§†åŒ–ä¸­å¿ƒåŠ è½½', fn: this.testVisualizationHub },
                        { id: 'test-3d', name: '3Dæ¨¡å‹æ¸²æŸ“', fn: this.test3DRendering },
                        { id: 'test-dashboard', name: 'æ•°æ®é¢æ¿', fn: this.testDashboard },
                        { id: 'test-mobile', name: 'ç§»åŠ¨ç«¯é€‚é…', fn: this.testMobileAdaptation }
                    ],
                    performance: [
                        { id: 'test-fcp', name: 'é¦–å±åŠ è½½æ—¶é—´', fn: this.testFirstContentfulPaint },
                        { id: 'test-js', name: 'JavaScriptæ‰§è¡Œ', fn: this.testJavaScriptExecution },
                        { id: 'test-memory', name: 'å†…å­˜ä½¿ç”¨', fn: this.testMemoryUsage },
                        { id: 'test-fps', name: 'æ¸²æŸ“å¸§ç‡', fn: this.testFrameRate }
                    ],
                    compatibility: [
                        { id: 'test-webgl', name: 'WebGLæ”¯æŒ', fn: this.testWebGLSupport },
                        { id: 'test-sw', name: 'Service Worker', fn: this.testServiceWorker },
                        { id: 'test-touch', name: 'è§¦æ‘¸æ‰‹åŠ¿', fn: this.testTouchGestures },
                        { id: 'test-pwa', name: 'PWAåŠŸèƒ½', fn: this.testPWAFeatures }
                    ],
                    security: [
                        { id: 'test-https', name: 'HTTPSåŠ å¯†', fn: this.testHTTPS },
                        { id: 'test-xss', name: 'XSSé˜²æŠ¤', fn: this.testXSSProtection },
                        { id: 'test-csp', name: 'å†…å®¹å®‰å…¨ç­–ç•¥', fn: this.testCSP },
                        { id: 'test-privacy', name: 'æ•°æ®éšç§', fn: this.testDataPrivacy }
                    ]
                };

                this.results = {
                    passed: 0,
                    failed: 0,
                    total: 0,
                    startTime: 0
                };

                this.log = document.getElementById('test-log');
            }

            async runAllTests() {
                this.log.innerHTML = '';
                this.logMessage('ğŸš€ å¼€å§‹è¿è¡Œé›†æˆæµ‹è¯•...', 'info');
                this.results.startTime = Date.now();
                this.results.passed = 0;
                this.results.failed = 0;
                this.results.total = 0;

                for (const [category, tests] of Object.entries(this.tests)) {
                    await this.runTestCategory(category, tests);
                }

                this.updateSummary();
                this.logMessage('âœ… æ‰€æœ‰æµ‹è¯•å®Œæˆ!', 'success');
            }

            async runTestCategory(category, tests) {
                this.logMessage(`ğŸ“‹ è¿è¡Œ ${category} æµ‹è¯•...`, 'info');
                this.setStatus(`${category}-status`, 'running');

                let categoryPassed = 0;

                for (const test of tests) {
                    this.results.total++;
                    this.setTestResult(test.id, 'running', 'æµ‹è¯•ä¸­...');

                    try {
                        const result = await test.fn.call(this);
                        if (result.success) {
                            this.setTestResult(test.id, 'pass', result.message || 'é€šè¿‡');
                            this.results.passed++;
                            categoryPassed++;
                            this.logMessage(`  âœ“ ${test.name}: ${result.message || 'é€šè¿‡'}`, 'success');
                        } else {
                            this.setTestResult(test.id, 'fail', result.message || 'å¤±è´¥');
                            this.results.failed++;
                            this.logMessage(`  âœ— ${test.name}: ${result.message || 'å¤±è´¥'}`, 'error');
                        }
                    } catch (error) {
                        this.setTestResult(test.id, 'fail', 'å¼‚å¸¸');
                        this.results.failed++;
                        this.logMessage(`  âœ— ${test.name}: ${error.message}`, 'error');
                    }

                    await this.delay(200);
                }

                this.setStatus(`${category}-status`, categoryPassed === tests.length ? 'success' : 'error');
                this.logMessage(`ğŸ“Š ${category} æµ‹è¯•å®Œæˆ: ${categoryPassed}/${tests.length}`, 'info');
            }

            // åŠŸèƒ½æµ‹è¯•
            async testVisualizationHub() {
                const hubExists = document.querySelector('.visualization-hub') ||
                                 document.querySelector('.tools') ||
                                 document.title.includes('ç»›å”‡è§£è¯­èŠ±');

                return {
                    success: hubExists,
                    message: hubExists ? 'ä¸­å¿ƒåŠ è½½æˆåŠŸ' : 'ä¸­å¿ƒæœªæ‰¾åˆ°'
                };
            }

            async test3DRendering() {
                const hasWebGL = this.checkWebGLSupport();
                const has3DOptimizer = typeof window.Model3DOptimizer !== 'undefined' ||
                                      document.querySelector('script[src*="3d"]');

                return {
                    success: hasWebGL && has3DOptimizer,
                    message: hasWebGL && has3DOptimizer ? '3Dæ¸²æŸ“å°±ç»ª' : '3Dæ”¯æŒä¸å®Œæ•´'
                };
            }

            async testDashboard() {
                const hasDashboard = document.querySelector('.dashboard') ||
                                   document.querySelector('canvas') ||
                                   typeof Chart !== 'undefined';

                return {
                    success: hasDashboard,
                    message: hasDashboard ? 'é¢æ¿å¯ç”¨' : 'é¢æ¿æœªå‘ç°'
                };
            }

            async testMobileAdaptation() {
                const isMobile = window.innerWidth < 768;
                const hasTouchSupport = 'ontouchstart' in window;
                const hasViewportMeta = document.querySelector('meta[name="viewport"]');

                return {
                    success: hasViewportMeta && (hasTouchSupport || !isMobile),
                    message: hasViewportMeta ? 'ç§»åŠ¨é€‚é…è‰¯å¥½' : 'ç¼ºå°‘viewportè®¾ç½®'
                };
            }

            // æ€§èƒ½æµ‹è¯•
            async testFirstContentfulPaint() {
                const fcp = performance.getEntriesByType('navigation')[0];
                const loadTime = fcp ? fcp.loadEventEnd - fcp.loadEventStart : 0;

                return {
                    success: loadTime < 3000,
                    message: `${loadTime.toFixed(0)}ms`
                };
            }

            async testJavaScriptExecution() {
                const start = performance.now();

                // æ‰§è¡Œä¸€äº›è®¡ç®—å¯†é›†å‹ä»»åŠ¡
                for (let i = 0; i < 100000; i++) {
                    Math.sqrt(i);
                }

                const executionTime = performance.now() - start;

                return {
                    success: executionTime < 100,
                    message: `${executionTime.toFixed(1)}ms`
                };
            }

            async testMemoryUsage() {
                if (!performance.memory) {
                    return { success: true, message: 'å†…å­˜APIä¸å¯ç”¨' };
                }

                const used = performance.memory.usedJSHeapSize / 1048576; // MB
                const limit = performance.memory.jsHeapSizeLimit / 1048576;

                return {
                    success: used < 100,
                    message: `${used.toFixed(1)}MB/${limit.toFixed(0)}MB`
                };
            }

            async testFrameRate() {
                return new Promise(resolve => {
                    let frames = 0;
                    const start = performance.now();

                    const countFrames = () => {
                        frames++;
                        if (frames < 60) {
                            requestAnimationFrame(countFrames);
                        } else {
                            const fps = Math.round(60000 / (performance.now() - start));
                            resolve({
                                success: fps >= 30,
                                message: `${fps} FPS`
                            });
                        }
                    };

                    requestAnimationFrame(countFrames);
                });
            }

            // å…¼å®¹æ€§æµ‹è¯•
            async testWebGLSupport() {
                const hasWebGL = this.checkWebGLSupport();
                return {
                    success: hasWebGL,
                    message: hasWebGL ? 'WebGLå¯ç”¨' : 'WebGLä¸æ”¯æŒ'
                };
            }

            async testServiceWorker() {
                const hasServiceWorker = 'serviceWorker' in navigator;
                let registered = false;

                if (hasServiceWorker) {
                    try {
                        const registrations = await navigator.serviceWorker.getRegistrations();
                        registered = registrations.length > 0;
                    } catch {}
                }

                return {
                    success: hasServiceWorker && registered,
                    message: hasServiceWorker ? (registered ? 'SWå·²æ³¨å†Œ' : 'SWæœªæ³¨å†Œ') : 'SWä¸æ”¯æŒ'
                };
            }

            async testTouchGestures() {
                const hasTouch = 'ontouchstart' in window;
                const hasPointer = 'onpointerdown' in window;

                return {
                    success: hasTouch || hasPointer,
                    message: hasTouch ? 'è§¦æ‘¸æ”¯æŒ' : hasPointer ? 'æŒ‡é’ˆæ”¯æŒ' : 'æ— è§¦æ‘¸æ”¯æŒ'
                };
            }

            async testPWAFeatures() {
                const hasManifest = document.querySelector('link[rel="manifest"]');
                const hasServiceWorker = 'serviceWorker' in navigator;
                const hasHTTPS = location.protocol === 'https:' || location.hostname === 'localhost';

                const score = [hasManifest, hasServiceWorker, hasHTTPS].filter(Boolean).length;

                return {
                    success: score >= 2,
                    message: `PWAå°±ç»ªåº¦: ${score}/3`
                };
            }

            // å®‰å…¨æµ‹è¯•
            async testHTTPS() {
                const isSecure = location.protocol === 'https:' ||
                               location.hostname === 'localhost' ||
                               location.hostname === '127.0.0.1';

                return {
                    success: isSecure,
                    message: isSecure ? 'å®‰å…¨è¿æ¥' : 'éå®‰å…¨è¿æ¥'
                };
            }

            async testXSSProtection() {
                // åŸºæœ¬XSSæµ‹è¯•
                const testScript = '<script>alert("xss")</script>';
                const div = document.createElement('div');
                div.innerHTML = testScript;

                const hasScript = div.querySelector('script');

                return {
                    success: !hasScript,
                    message: hasScript ? 'XSSé£é™©' : 'XSSé˜²æŠ¤æ­£å¸¸'
                };
            }

            async testCSP() {
                const cspMeta = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
                const hasCSPHeader = document.createElement('img').src = 'data:';

                return {
                    success: cspMeta !== null,
                    message: cspMeta ? 'CSPå·²é…ç½®' : 'CSPæœªé…ç½®'
                };
            }

            async testDataPrivacy() {
                const hasPrivacyPolicy = document.querySelector('a[href*="privacy"]') ||
                                       document.querySelector('a[href*="éšç§"]');
                const localStorage = window.localStorage;

                return {
                    success: true, // åŸºç¡€éšç§ä¿æŠ¤
                    message: 'éšç§ä¿æŠ¤åŸºçº¿'
                };
            }

            // å·¥å…·æ–¹æ³•
            checkWebGLSupport() {
                try {
                    const canvas = document.createElement('canvas');
                    return !!(canvas.getContext('webgl') || canvas.getContext('experimental-webgl'));
                } catch {
                    return false;
                }
            }

            setStatus(elementId, status) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.className = `test-status status-${status}`;
                }
            }

            setTestResult(elementId, type, message) {
                const element = document.getElementById(elementId);
                if (element) {
                    element.className = `test-result result-${type}`;
                    element.textContent = message;
                }
            }

            updateSummary() {
                const total = this.results.total;
                const passed = this.results.passed;
                const failed = this.results.failed;
                const successRate = total > 0 ? Math.round((passed / total) * 100) : 0;
                const testTime = ((Date.now() - this.results.startTime) / 1000).toFixed(1);

                document.getElementById('total-tests').textContent = total;
                document.getElementById('passed-tests').textContent = passed;
                document.getElementById('failed-tests').textContent = failed;
                document.getElementById('success-rate').textContent = successRate + '%';
                document.getElementById('test-time').textContent = testTime + 's';
            }

            logMessage(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const colors = {
                    info: '#00ff00',
                    success: '#00ff00',
                    error: '#ff0000',
                    warning: '#ffff00'
                };

                this.log.innerHTML += `<span style="color: ${colors[type] || '#00ff00'}">[${timestamp}] ${message}</span><br>`;
                this.log.scrollTop = this.log.scrollHeight;
            }

            delay(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // å…¨å±€å®ä¾‹
        const tester = new IntegrationTester();

        // å…¨å±€å‡½æ•°
        function runAllTests() {
            tester.runAllTests();
        }

        function runSingleTest() {
            alert('å•é¡¹æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...');
        }

        function generateReport() {
            const reportData = {
                timestamp: new Date().toISOString(),
                results: tester.results,
                userAgent: navigator.userAgent,
                viewport: `${window.innerWidth}x${window.innerHeight}`,
                performance: performance.memory ? {
                    used: Math.round(performance.memory.usedJSHeapSize / 1048576),
                    total: Math.round(performance.memory.totalJSHeapSize / 1048576)
                } : null
            };

            const blob = new Blob([JSON.stringify(reportData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `integration-test-report-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡ŒåŸºç¡€æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', () => {
            tester.logMessage('ğŸ”§ é›†æˆæµ‹è¯•ç³»ç»Ÿåˆå§‹åŒ–å®Œæˆ', 'success');
            tester.logMessage('ğŸ“ ç‚¹å‡»"è¿è¡Œå…¨éƒ¨æµ‹è¯•"å¼€å§‹å®Œæ•´éªŒè¯', 'info');
        });
    </script>
</body>
</html>